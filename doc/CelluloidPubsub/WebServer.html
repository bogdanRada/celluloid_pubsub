<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: CelluloidPubsub::WebServer
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!CelluloidPubsub/WebServer.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (W)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../CelluloidPubsub.html" title="CelluloidPubsub (module)">CelluloidPubsub</a></span></span>
     &raquo; 
    <span class="title">WebServer</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: CelluloidPubsub::WebServer
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Reel::Server::HTTP</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Reel::Server::HTTP</li>
          
            <li class="next">CelluloidPubsub::WebServer</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2">Celluloid::Logger</dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/celluloid_pubsub/web_server.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>webserver to which socket connects should connect to . the server will
dispatch each request into a new Reactor which will handle the action based
on the message</p>


  </div>
</div>
<div class="tags">
  

</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="HOST-constant" class="">HOST =
          <div class="docstring">
  <div class="discussion">
    
<p>The hostname on which the webserver runs on by default</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0.0.0.0</span><span class='tstring_end'>&#39;</span></span></pre></dd>
      
        <dt id="PORT-constant" class="">PORT =
          <div class="docstring">
  <div class="discussion">
    
<p>The port on which the webserver runs on by default</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>1234</span></pre></dd>
      
        <dt id="PATH-constant" class="">PATH =
          <div class="docstring">
  <div class="discussion">
    
<p>The request path that the webserver accepts by default</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/ws</span><span class='tstring_end'>&#39;</span></span></pre></dd>
      
    </dl>
  




  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#backlog-instance_method" title="#backlog (instance method)">- (Integer) <strong>backlog</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Defaults to 1024.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#hostname-instance_method" title="#hostname (instance method)">- (String) <strong>hostname</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The hostname on which the webserver runs on.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#options-instance_method" title="#options (instance method)">- (Hash) <strong>options</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Options used to configure the webserver.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#path-instance_method" title="#path (instance method)">- (String) <strong>path</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The hostname on which the webserver runs on.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#port-instance_method" title="#port (instance method)">- (String) <strong>port</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The port on which the webserver runs on.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#spy-instance_method" title="#spy (instance method)">- (Boolean) <strong>spy</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Enable this only if you want to enable debugging for the webserver.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#subscribers-instance_method" title="#subscribers (instance method)">- (Hash) <strong>subscribers</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The hostname on which the webserver runs on.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#debug_enabled%3F-class_method" title="debug_enabled? (class method)">+ (boolean) <strong>debug_enabled?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>checks if debug is enabled.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#debug_enabled%3F-instance_method" title="#debug_enabled? (instance method)">- (boolean) <strong>debug_enabled?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>checks if debug is enabled.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#handle_dispatched_message-instance_method" title="#handle_dispatched_message (instance method)">- (void) <strong>handle_dispatched_message</strong>(reactor, data) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>If the message can be parsed into a Hash it will respond to the
reactor&#39;s websocket connection with the same message in JSON format
otherwise will try send the message how it is and escaped into JSON format.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (void) <strong>initialize</strong>(options = {}) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>receives a list of options that are used to configure the webserver.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_connection-instance_method" title="#on_connection (instance method)">- (void) <strong>on_connection</strong>(connection) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>callback that will execute when receiving new conections If the connections
is a websocket will call method <span class='object_link'><a href="#route_websocket-instance_method" title="CelluloidPubsub::WebServer#route_websocket (method)">#route_websocket</a></span> and if the connection is
HTTP will call method <span class='object_link'><a href="#route_request-instance_method" title="CelluloidPubsub::WebServer#route_request (method)">#route_request</a></span> For websocket connections , the
connection is detached from the server and dispatched to another actor.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parse_options-instance_method" title="#parse_options (instance method)">- (void) <strong>parse_options</strong>(options) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>receives a list of options that are used to configure the webserver.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#publish_event-instance_method" title="#publish_event (instance method)">- (void) <strong>publish_event</strong>(current_topic, message) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>checks if debug is enabled.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#route_request-instance_method" title="#route_request (instance method)">- (void) <strong>route_request</strong>(connection, request) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>HTTP connections are not accepted so this method will show 404 message “Not
Found”.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#route_websocket-instance_method" title="#route_websocket (instance method)">- (void) <strong>route_websocket</strong>(socket) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>If the socket url matches with the one accepted by the server, it will
dispatch the socket connection to a new reactor
<span class='object_link'><a href="Reactor.html#work-instance_method" title="CelluloidPubsub::Reactor#work (method)">Reactor#work</a></span> The new actor is linked to the webserver.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt>void</tt>) <strong>initialize</strong>(options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>receives a list of options that are used to configure the webserver</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>the options that can be used to connect to webser and send additional data</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:hostname</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The hostname on which the webserver runs on</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:port</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The port on which the webserver runs on</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:path</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The request path that the webserver accepts</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:spy</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Enable this only if you want to enable debugging for the webserver</p>
</div>
          
        </li>
      
    </ul>
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


54
55
56
57
58
59</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/celluloid_pubsub/web_server.rb', line 54</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_parse_options'>parse_options</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='ivar'>@subscribers</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CelluloidPubsub::WebServer example starting on </span><span class='embexpr_beg'>#{</span><span class='ivar'>@hostname</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='ivar'>@port</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
  <span class='kw'>super</span><span class='lparen'>(</span><span class='ivar'>@hostname</span><span class='comma'>,</span> <span class='ivar'>@port</span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='label'>spy:</span> <span class='ivar'>@spy</span><span class='comma'>,</span> <span class='label'>backlog:</span> <span class='ivar'>@backlog</span> <span class='rbrace'>}</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_method'>method</span><span class='lparen'>(</span><span class='symbol'>:on_connection</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="backlog=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="backlog-instance_method">
  
    - (<tt>Integer</tt>) <strong>backlog</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Defaults to 1024</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Determines how many connections can be used</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/celluloid_pubsub/web_server.rb', line 31</span>

<span class='kw'>class</span> <span class='const'>WebServer</span> <span class='op'>&lt;</span> <span class='const'>Reel</span><span class='op'>::</span><span class='const'>Server</span><span class='op'>::</span><span class='const'>HTTP</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Celluloid</span><span class='op'>::</span><span class='const'>Logger</span>

  <span class='comment'># The hostname on which the webserver runs on by default
</span>  <span class='const'>HOST</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0.0.0.0</span><span class='tstring_end'>&#39;</span></span>
  <span class='comment'># The port on which the webserver runs on by default
</span>  <span class='const'>PORT</span> <span class='op'>=</span> <span class='int'>1234</span>
  <span class='comment'># The request path that the webserver accepts by default
</span>  <span class='const'>PATH</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/ws</span><span class='tstring_end'>&#39;</span></span>

  <span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbol'>:options</span><span class='comma'>,</span> <span class='symbol'>:subscribers</span><span class='comma'>,</span> <span class='symbol'>:backlog</span><span class='comma'>,</span> <span class='symbol'>:hostname</span><span class='comma'>,</span> <span class='symbol'>:port</span><span class='comma'>,</span> <span class='symbol'>:path</span><span class='comma'>,</span> <span class='symbol'>:spy</span>

  <span class='comment'>#  receives a list of options that are used to configure the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @param  [Hash]  options the options that can be used to connect to webser and send additional data
</span>  <span class='comment'># @option options [String]:hostname The hostname on which the webserver runs on
</span>  <span class='comment'># @option options [Integer] :port The port on which the webserver runs on
</span>  <span class='comment'># @option options [String] :path The request path that the webserver accepts
</span>  <span class='comment'># @option options [Boolean] :spy Enable this only if you want to enable debugging for the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_parse_options'>parse_options</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='ivar'>@subscribers</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CelluloidPubsub::WebServer example starting on </span><span class='embexpr_beg'>#{</span><span class='ivar'>@hostname</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='ivar'>@port</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='kw'>super</span><span class='lparen'>(</span><span class='ivar'>@hostname</span><span class='comma'>,</span> <span class='ivar'>@port</span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='label'>spy:</span> <span class='ivar'>@spy</span><span class='comma'>,</span> <span class='label'>backlog:</span> <span class='ivar'>@backlog</span> <span class='rbrace'>}</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_method'>method</span><span class='lparen'>(</span><span class='symbol'>:on_connection</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'>#  receives a list of options that are used to configure the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @param  [Hash]  options the options that can be used to connect to webser and send additional data
</span>  <span class='comment'># @option options [String]:hostname The hostname on which the webserver runs on
</span>  <span class='comment'># @option options [Integer] :port The port on which the webserver runs on
</span>  <span class='comment'># @option options [String] :path The request path that the webserver accepts
</span>  <span class='comment'># @option options [Boolean] :spy Enable this only if you want to enable debugging for the webserver
</span>  <span class='comment'># @option options [Integer]:backlog How many connections the server accepts
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_parse_options'>parse_options</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Options is not a hash </span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
    <span class='ivar'>@options</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_stringify_keys'>stringify_keys</span>
    <span class='ivar'>@backlog</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:backlog</span><span class='comma'>,</span> <span class='int'>1024</span><span class='rparen'>)</span>
    <span class='ivar'>@hostname</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:hostname</span><span class='comma'>,</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>WebServer</span><span class='op'>::</span><span class='const'>HOST</span><span class='rparen'>)</span>
    <span class='ivar'>@port</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:port</span><span class='comma'>,</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>WebServer</span><span class='op'>::</span><span class='const'>PORT</span><span class='rparen'>)</span>
    <span class='ivar'>@path</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:path</span><span class='comma'>,</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>WebServer</span><span class='op'>::</span><span class='const'>PATH</span><span class='rparen'>)</span>
    <span class='ivar'>@spy</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:spy</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'>#  checks if debug is enabled
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [boolean]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
  <span class='kw'>end</span>

  <span class='comment'>#  checks if debug is enabled
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [boolean]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DEBUG_CELLULOID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DEBUG_CELLULOID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>true</span><span class='tstring_end'>&#39;</span></span> <span class='op'>||</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DEBUG_CELLULOID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'>#  checks if debug is enabled
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [String] current_topic The Channel to which the reactor instance {CelluloidPubsub::Rector} will publish the message to
</span>  <span class='comment'># @param [Object] message
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_publish_event'>publish_event</span><span class='lparen'>(</span><span class='id identifier rubyid_current_topic'>current_topic</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_current_topic'>current_topic</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>||</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='ivar'>@subscribers</span><span class='lbracket'>[</span><span class='id identifier rubyid_current_topic'>current_topic</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_hash'>hash</span><span class='op'>|</span>
      <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='symbol'>:reactor</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_message'>message</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>#  callback that will execute when receiving new conections
</span>  <span class='comment'># If the connections is a websocket will call method {#route_websocket}
</span>  <span class='comment'># and if the connection is HTTP will call method {#route_request}
</span>  <span class='comment'># For websocket connections , the connection is detached from the server and dispatched to another actor
</span>  <span class='comment'>#
</span>  <span class='comment'># @see #route_websocket
</span>  <span class='comment'># @see #route_request
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Reel::WebSocket] connection The connection that was made to the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_on_connection'>on_connection</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='rparen'>)</span>
    <span class='kw'>while</span> <span class='id identifier rubyid_request'>request</span> <span class='op'>=</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_request'>request</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_websocket?'>websocket?</span>
        <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Received a WebSocket connection</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>

        <span class='comment'># We&#39;re going to hand off this connection to another actor (Writer/Reader)
</span>        <span class='comment'># However, initially Reel::Connections are &quot;attached&quot; to the
</span>        <span class='comment'># Reel::Server::HTTP actor, meaning that the server manages the connection
</span>        <span class='comment'># lifecycle (e.g. error handling) for us.
</span>        <span class='comment'>#
</span>        <span class='comment'># If we want to hand this connection off to another actor, we first
</span>        <span class='comment'># need to detach it from the Reel::Server (in this case, Reel::Server::HTTP)
</span>        <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_detach'>detach</span>
        <span class='id identifier rubyid_route_websocket'>route_websocket</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span><span class='rparen'>)</span>
        <span class='kw'>return</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_route_request'>route_request</span> <span class='id identifier rubyid_connection'>connection</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>#  HTTP connections are not accepted so this method will show 404 message &quot;Not Found&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Reel::WebSocket] connection The HTTP connection that was received
</span>  <span class='comment'># @param [Reel::Request] request The request that was made to the webserver and contains the type , the url, and the parameters
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_route_request'>route_request</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>404 Not Found: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_respond'>respond</span> <span class='symbol'>:not_found</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Not found</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='comment'>#  If the socket url matches with the one accepted by the server, it will dispatch the socket connection to a new reactor {CelluloidPubsub::Reactor#work}
</span>  <span class='comment'># The new actor is linked to the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @see CelluloidPubsub::Reactor#work
</span>  <span class='comment'>#
</span>  <span class='comment'>#  @param [Reel::WebSocket] socket The  web socket connection that was received
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_route_websocket'>route_websocket</span><span class='lparen'>(</span><span class='id identifier rubyid_socket'>socket</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span> <span class='op'>==</span> <span class='ivar'>@path</span>
      <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Reactor handles new socket connection</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
      <span class='id identifier rubyid_reactor'>reactor</span> <span class='op'>=</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>Reactor</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
      <span class='const'>Actor</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_link'>link</span> <span class='id identifier rubyid_reactor'>reactor</span>
      <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_async'>async</span><span class='period'>.</span><span class='id identifier rubyid_work'>work</span><span class='lparen'>(</span><span class='id identifier rubyid_socket'>socket</span><span class='comma'>,</span> <span class='const'>Actor</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Received invalid WebSocket request for: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
      <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># If the message can be parsed into a Hash it will respond to the reactor&#39;s websocket connection with the same message in JSON format
</span>  <span class='comment'># otherwise will try send the message how it is and escaped into JSON format
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [CelluloidPubsub::Reactor] reactor The  reactor that received an unhandled message
</span>  <span class='comment'># @param [Object] data The message that the reactor could not handle
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_handle_dispatched_message'>handle_dispatched_message</span><span class='lparen'>(</span><span class='id identifier rubyid_reactor'>reactor</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Webserver trying to dispatch message  </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_parse_json_data'>parse_json_data</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="hostname=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="hostname-instance_method">
  
    - (<tt>String</tt>) <strong>hostname</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns The hostname on which the webserver runs on</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The hostname on which the webserver runs on</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/celluloid_pubsub/web_server.rb', line 31</span>

<span class='kw'>class</span> <span class='const'>WebServer</span> <span class='op'>&lt;</span> <span class='const'>Reel</span><span class='op'>::</span><span class='const'>Server</span><span class='op'>::</span><span class='const'>HTTP</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Celluloid</span><span class='op'>::</span><span class='const'>Logger</span>

  <span class='comment'># The hostname on which the webserver runs on by default
</span>  <span class='const'>HOST</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0.0.0.0</span><span class='tstring_end'>&#39;</span></span>
  <span class='comment'># The port on which the webserver runs on by default
</span>  <span class='const'>PORT</span> <span class='op'>=</span> <span class='int'>1234</span>
  <span class='comment'># The request path that the webserver accepts by default
</span>  <span class='const'>PATH</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/ws</span><span class='tstring_end'>&#39;</span></span>

  <span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbol'>:options</span><span class='comma'>,</span> <span class='symbol'>:subscribers</span><span class='comma'>,</span> <span class='symbol'>:backlog</span><span class='comma'>,</span> <span class='symbol'>:hostname</span><span class='comma'>,</span> <span class='symbol'>:port</span><span class='comma'>,</span> <span class='symbol'>:path</span><span class='comma'>,</span> <span class='symbol'>:spy</span>

  <span class='comment'>#  receives a list of options that are used to configure the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @param  [Hash]  options the options that can be used to connect to webser and send additional data
</span>  <span class='comment'># @option options [String]:hostname The hostname on which the webserver runs on
</span>  <span class='comment'># @option options [Integer] :port The port on which the webserver runs on
</span>  <span class='comment'># @option options [String] :path The request path that the webserver accepts
</span>  <span class='comment'># @option options [Boolean] :spy Enable this only if you want to enable debugging for the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_parse_options'>parse_options</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='ivar'>@subscribers</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CelluloidPubsub::WebServer example starting on </span><span class='embexpr_beg'>#{</span><span class='ivar'>@hostname</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='ivar'>@port</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='kw'>super</span><span class='lparen'>(</span><span class='ivar'>@hostname</span><span class='comma'>,</span> <span class='ivar'>@port</span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='label'>spy:</span> <span class='ivar'>@spy</span><span class='comma'>,</span> <span class='label'>backlog:</span> <span class='ivar'>@backlog</span> <span class='rbrace'>}</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_method'>method</span><span class='lparen'>(</span><span class='symbol'>:on_connection</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'>#  receives a list of options that are used to configure the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @param  [Hash]  options the options that can be used to connect to webser and send additional data
</span>  <span class='comment'># @option options [String]:hostname The hostname on which the webserver runs on
</span>  <span class='comment'># @option options [Integer] :port The port on which the webserver runs on
</span>  <span class='comment'># @option options [String] :path The request path that the webserver accepts
</span>  <span class='comment'># @option options [Boolean] :spy Enable this only if you want to enable debugging for the webserver
</span>  <span class='comment'># @option options [Integer]:backlog How many connections the server accepts
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_parse_options'>parse_options</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Options is not a hash </span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
    <span class='ivar'>@options</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_stringify_keys'>stringify_keys</span>
    <span class='ivar'>@backlog</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:backlog</span><span class='comma'>,</span> <span class='int'>1024</span><span class='rparen'>)</span>
    <span class='ivar'>@hostname</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:hostname</span><span class='comma'>,</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>WebServer</span><span class='op'>::</span><span class='const'>HOST</span><span class='rparen'>)</span>
    <span class='ivar'>@port</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:port</span><span class='comma'>,</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>WebServer</span><span class='op'>::</span><span class='const'>PORT</span><span class='rparen'>)</span>
    <span class='ivar'>@path</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:path</span><span class='comma'>,</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>WebServer</span><span class='op'>::</span><span class='const'>PATH</span><span class='rparen'>)</span>
    <span class='ivar'>@spy</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:spy</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'>#  checks if debug is enabled
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [boolean]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
  <span class='kw'>end</span>

  <span class='comment'>#  checks if debug is enabled
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [boolean]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DEBUG_CELLULOID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DEBUG_CELLULOID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>true</span><span class='tstring_end'>&#39;</span></span> <span class='op'>||</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DEBUG_CELLULOID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'>#  checks if debug is enabled
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [String] current_topic The Channel to which the reactor instance {CelluloidPubsub::Rector} will publish the message to
</span>  <span class='comment'># @param [Object] message
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_publish_event'>publish_event</span><span class='lparen'>(</span><span class='id identifier rubyid_current_topic'>current_topic</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_current_topic'>current_topic</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>||</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='ivar'>@subscribers</span><span class='lbracket'>[</span><span class='id identifier rubyid_current_topic'>current_topic</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_hash'>hash</span><span class='op'>|</span>
      <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='symbol'>:reactor</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_message'>message</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>#  callback that will execute when receiving new conections
</span>  <span class='comment'># If the connections is a websocket will call method {#route_websocket}
</span>  <span class='comment'># and if the connection is HTTP will call method {#route_request}
</span>  <span class='comment'># For websocket connections , the connection is detached from the server and dispatched to another actor
</span>  <span class='comment'>#
</span>  <span class='comment'># @see #route_websocket
</span>  <span class='comment'># @see #route_request
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Reel::WebSocket] connection The connection that was made to the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_on_connection'>on_connection</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='rparen'>)</span>
    <span class='kw'>while</span> <span class='id identifier rubyid_request'>request</span> <span class='op'>=</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_request'>request</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_websocket?'>websocket?</span>
        <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Received a WebSocket connection</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>

        <span class='comment'># We&#39;re going to hand off this connection to another actor (Writer/Reader)
</span>        <span class='comment'># However, initially Reel::Connections are &quot;attached&quot; to the
</span>        <span class='comment'># Reel::Server::HTTP actor, meaning that the server manages the connection
</span>        <span class='comment'># lifecycle (e.g. error handling) for us.
</span>        <span class='comment'>#
</span>        <span class='comment'># If we want to hand this connection off to another actor, we first
</span>        <span class='comment'># need to detach it from the Reel::Server (in this case, Reel::Server::HTTP)
</span>        <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_detach'>detach</span>
        <span class='id identifier rubyid_route_websocket'>route_websocket</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span><span class='rparen'>)</span>
        <span class='kw'>return</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_route_request'>route_request</span> <span class='id identifier rubyid_connection'>connection</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>#  HTTP connections are not accepted so this method will show 404 message &quot;Not Found&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Reel::WebSocket] connection The HTTP connection that was received
</span>  <span class='comment'># @param [Reel::Request] request The request that was made to the webserver and contains the type , the url, and the parameters
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_route_request'>route_request</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>404 Not Found: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_respond'>respond</span> <span class='symbol'>:not_found</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Not found</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='comment'>#  If the socket url matches with the one accepted by the server, it will dispatch the socket connection to a new reactor {CelluloidPubsub::Reactor#work}
</span>  <span class='comment'># The new actor is linked to the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @see CelluloidPubsub::Reactor#work
</span>  <span class='comment'>#
</span>  <span class='comment'>#  @param [Reel::WebSocket] socket The  web socket connection that was received
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_route_websocket'>route_websocket</span><span class='lparen'>(</span><span class='id identifier rubyid_socket'>socket</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span> <span class='op'>==</span> <span class='ivar'>@path</span>
      <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Reactor handles new socket connection</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
      <span class='id identifier rubyid_reactor'>reactor</span> <span class='op'>=</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>Reactor</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
      <span class='const'>Actor</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_link'>link</span> <span class='id identifier rubyid_reactor'>reactor</span>
      <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_async'>async</span><span class='period'>.</span><span class='id identifier rubyid_work'>work</span><span class='lparen'>(</span><span class='id identifier rubyid_socket'>socket</span><span class='comma'>,</span> <span class='const'>Actor</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Received invalid WebSocket request for: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
      <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># If the message can be parsed into a Hash it will respond to the reactor&#39;s websocket connection with the same message in JSON format
</span>  <span class='comment'># otherwise will try send the message how it is and escaped into JSON format
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [CelluloidPubsub::Reactor] reactor The  reactor that received an unhandled message
</span>  <span class='comment'># @param [Object] data The message that the reactor could not handle
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_handle_dispatched_message'>handle_dispatched_message</span><span class='lparen'>(</span><span class='id identifier rubyid_reactor'>reactor</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Webserver trying to dispatch message  </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_parse_json_data'>parse_json_data</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="options=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="options-instance_method">
  
    - (<tt>Hash</tt>) <strong>options</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns options used to configure the webserver</p>


  </div>
</div>
<div class="tags">
  
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>options used to configure the webserver</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/celluloid_pubsub/web_server.rb', line 31</span>

<span class='kw'>class</span> <span class='const'>WebServer</span> <span class='op'>&lt;</span> <span class='const'>Reel</span><span class='op'>::</span><span class='const'>Server</span><span class='op'>::</span><span class='const'>HTTP</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Celluloid</span><span class='op'>::</span><span class='const'>Logger</span>

  <span class='comment'># The hostname on which the webserver runs on by default
</span>  <span class='const'>HOST</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0.0.0.0</span><span class='tstring_end'>&#39;</span></span>
  <span class='comment'># The port on which the webserver runs on by default
</span>  <span class='const'>PORT</span> <span class='op'>=</span> <span class='int'>1234</span>
  <span class='comment'># The request path that the webserver accepts by default
</span>  <span class='const'>PATH</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/ws</span><span class='tstring_end'>&#39;</span></span>

  <span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbol'>:options</span><span class='comma'>,</span> <span class='symbol'>:subscribers</span><span class='comma'>,</span> <span class='symbol'>:backlog</span><span class='comma'>,</span> <span class='symbol'>:hostname</span><span class='comma'>,</span> <span class='symbol'>:port</span><span class='comma'>,</span> <span class='symbol'>:path</span><span class='comma'>,</span> <span class='symbol'>:spy</span>

  <span class='comment'>#  receives a list of options that are used to configure the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @param  [Hash]  options the options that can be used to connect to webser and send additional data
</span>  <span class='comment'># @option options [String]:hostname The hostname on which the webserver runs on
</span>  <span class='comment'># @option options [Integer] :port The port on which the webserver runs on
</span>  <span class='comment'># @option options [String] :path The request path that the webserver accepts
</span>  <span class='comment'># @option options [Boolean] :spy Enable this only if you want to enable debugging for the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_parse_options'>parse_options</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='ivar'>@subscribers</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CelluloidPubsub::WebServer example starting on </span><span class='embexpr_beg'>#{</span><span class='ivar'>@hostname</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='ivar'>@port</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='kw'>super</span><span class='lparen'>(</span><span class='ivar'>@hostname</span><span class='comma'>,</span> <span class='ivar'>@port</span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='label'>spy:</span> <span class='ivar'>@spy</span><span class='comma'>,</span> <span class='label'>backlog:</span> <span class='ivar'>@backlog</span> <span class='rbrace'>}</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_method'>method</span><span class='lparen'>(</span><span class='symbol'>:on_connection</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'>#  receives a list of options that are used to configure the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @param  [Hash]  options the options that can be used to connect to webser and send additional data
</span>  <span class='comment'># @option options [String]:hostname The hostname on which the webserver runs on
</span>  <span class='comment'># @option options [Integer] :port The port on which the webserver runs on
</span>  <span class='comment'># @option options [String] :path The request path that the webserver accepts
</span>  <span class='comment'># @option options [Boolean] :spy Enable this only if you want to enable debugging for the webserver
</span>  <span class='comment'># @option options [Integer]:backlog How many connections the server accepts
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_parse_options'>parse_options</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Options is not a hash </span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
    <span class='ivar'>@options</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_stringify_keys'>stringify_keys</span>
    <span class='ivar'>@backlog</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:backlog</span><span class='comma'>,</span> <span class='int'>1024</span><span class='rparen'>)</span>
    <span class='ivar'>@hostname</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:hostname</span><span class='comma'>,</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>WebServer</span><span class='op'>::</span><span class='const'>HOST</span><span class='rparen'>)</span>
    <span class='ivar'>@port</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:port</span><span class='comma'>,</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>WebServer</span><span class='op'>::</span><span class='const'>PORT</span><span class='rparen'>)</span>
    <span class='ivar'>@path</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:path</span><span class='comma'>,</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>WebServer</span><span class='op'>::</span><span class='const'>PATH</span><span class='rparen'>)</span>
    <span class='ivar'>@spy</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:spy</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'>#  checks if debug is enabled
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [boolean]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
  <span class='kw'>end</span>

  <span class='comment'>#  checks if debug is enabled
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [boolean]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DEBUG_CELLULOID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DEBUG_CELLULOID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>true</span><span class='tstring_end'>&#39;</span></span> <span class='op'>||</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DEBUG_CELLULOID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'>#  checks if debug is enabled
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [String] current_topic The Channel to which the reactor instance {CelluloidPubsub::Rector} will publish the message to
</span>  <span class='comment'># @param [Object] message
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_publish_event'>publish_event</span><span class='lparen'>(</span><span class='id identifier rubyid_current_topic'>current_topic</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_current_topic'>current_topic</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>||</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='ivar'>@subscribers</span><span class='lbracket'>[</span><span class='id identifier rubyid_current_topic'>current_topic</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_hash'>hash</span><span class='op'>|</span>
      <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='symbol'>:reactor</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_message'>message</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>#  callback that will execute when receiving new conections
</span>  <span class='comment'># If the connections is a websocket will call method {#route_websocket}
</span>  <span class='comment'># and if the connection is HTTP will call method {#route_request}
</span>  <span class='comment'># For websocket connections , the connection is detached from the server and dispatched to another actor
</span>  <span class='comment'>#
</span>  <span class='comment'># @see #route_websocket
</span>  <span class='comment'># @see #route_request
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Reel::WebSocket] connection The connection that was made to the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_on_connection'>on_connection</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='rparen'>)</span>
    <span class='kw'>while</span> <span class='id identifier rubyid_request'>request</span> <span class='op'>=</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_request'>request</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_websocket?'>websocket?</span>
        <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Received a WebSocket connection</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>

        <span class='comment'># We&#39;re going to hand off this connection to another actor (Writer/Reader)
</span>        <span class='comment'># However, initially Reel::Connections are &quot;attached&quot; to the
</span>        <span class='comment'># Reel::Server::HTTP actor, meaning that the server manages the connection
</span>        <span class='comment'># lifecycle (e.g. error handling) for us.
</span>        <span class='comment'>#
</span>        <span class='comment'># If we want to hand this connection off to another actor, we first
</span>        <span class='comment'># need to detach it from the Reel::Server (in this case, Reel::Server::HTTP)
</span>        <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_detach'>detach</span>
        <span class='id identifier rubyid_route_websocket'>route_websocket</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span><span class='rparen'>)</span>
        <span class='kw'>return</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_route_request'>route_request</span> <span class='id identifier rubyid_connection'>connection</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>#  HTTP connections are not accepted so this method will show 404 message &quot;Not Found&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Reel::WebSocket] connection The HTTP connection that was received
</span>  <span class='comment'># @param [Reel::Request] request The request that was made to the webserver and contains the type , the url, and the parameters
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_route_request'>route_request</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>404 Not Found: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_respond'>respond</span> <span class='symbol'>:not_found</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Not found</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='comment'>#  If the socket url matches with the one accepted by the server, it will dispatch the socket connection to a new reactor {CelluloidPubsub::Reactor#work}
</span>  <span class='comment'># The new actor is linked to the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @see CelluloidPubsub::Reactor#work
</span>  <span class='comment'>#
</span>  <span class='comment'>#  @param [Reel::WebSocket] socket The  web socket connection that was received
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_route_websocket'>route_websocket</span><span class='lparen'>(</span><span class='id identifier rubyid_socket'>socket</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span> <span class='op'>==</span> <span class='ivar'>@path</span>
      <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Reactor handles new socket connection</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
      <span class='id identifier rubyid_reactor'>reactor</span> <span class='op'>=</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>Reactor</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
      <span class='const'>Actor</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_link'>link</span> <span class='id identifier rubyid_reactor'>reactor</span>
      <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_async'>async</span><span class='period'>.</span><span class='id identifier rubyid_work'>work</span><span class='lparen'>(</span><span class='id identifier rubyid_socket'>socket</span><span class='comma'>,</span> <span class='const'>Actor</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Received invalid WebSocket request for: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
      <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># If the message can be parsed into a Hash it will respond to the reactor&#39;s websocket connection with the same message in JSON format
</span>  <span class='comment'># otherwise will try send the message how it is and escaped into JSON format
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [CelluloidPubsub::Reactor] reactor The  reactor that received an unhandled message
</span>  <span class='comment'># @param [Object] data The message that the reactor could not handle
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_handle_dispatched_message'>handle_dispatched_message</span><span class='lparen'>(</span><span class='id identifier rubyid_reactor'>reactor</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Webserver trying to dispatch message  </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_parse_json_data'>parse_json_data</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="path=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="path-instance_method">
  
    - (<tt>String</tt>) <strong>path</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns The hostname on which the webserver runs on</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The hostname on which the webserver runs on</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/celluloid_pubsub/web_server.rb', line 31</span>

<span class='kw'>class</span> <span class='const'>WebServer</span> <span class='op'>&lt;</span> <span class='const'>Reel</span><span class='op'>::</span><span class='const'>Server</span><span class='op'>::</span><span class='const'>HTTP</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Celluloid</span><span class='op'>::</span><span class='const'>Logger</span>

  <span class='comment'># The hostname on which the webserver runs on by default
</span>  <span class='const'>HOST</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0.0.0.0</span><span class='tstring_end'>&#39;</span></span>
  <span class='comment'># The port on which the webserver runs on by default
</span>  <span class='const'>PORT</span> <span class='op'>=</span> <span class='int'>1234</span>
  <span class='comment'># The request path that the webserver accepts by default
</span>  <span class='const'>PATH</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/ws</span><span class='tstring_end'>&#39;</span></span>

  <span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbol'>:options</span><span class='comma'>,</span> <span class='symbol'>:subscribers</span><span class='comma'>,</span> <span class='symbol'>:backlog</span><span class='comma'>,</span> <span class='symbol'>:hostname</span><span class='comma'>,</span> <span class='symbol'>:port</span><span class='comma'>,</span> <span class='symbol'>:path</span><span class='comma'>,</span> <span class='symbol'>:spy</span>

  <span class='comment'>#  receives a list of options that are used to configure the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @param  [Hash]  options the options that can be used to connect to webser and send additional data
</span>  <span class='comment'># @option options [String]:hostname The hostname on which the webserver runs on
</span>  <span class='comment'># @option options [Integer] :port The port on which the webserver runs on
</span>  <span class='comment'># @option options [String] :path The request path that the webserver accepts
</span>  <span class='comment'># @option options [Boolean] :spy Enable this only if you want to enable debugging for the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_parse_options'>parse_options</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='ivar'>@subscribers</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CelluloidPubsub::WebServer example starting on </span><span class='embexpr_beg'>#{</span><span class='ivar'>@hostname</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='ivar'>@port</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='kw'>super</span><span class='lparen'>(</span><span class='ivar'>@hostname</span><span class='comma'>,</span> <span class='ivar'>@port</span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='label'>spy:</span> <span class='ivar'>@spy</span><span class='comma'>,</span> <span class='label'>backlog:</span> <span class='ivar'>@backlog</span> <span class='rbrace'>}</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_method'>method</span><span class='lparen'>(</span><span class='symbol'>:on_connection</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'>#  receives a list of options that are used to configure the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @param  [Hash]  options the options that can be used to connect to webser and send additional data
</span>  <span class='comment'># @option options [String]:hostname The hostname on which the webserver runs on
</span>  <span class='comment'># @option options [Integer] :port The port on which the webserver runs on
</span>  <span class='comment'># @option options [String] :path The request path that the webserver accepts
</span>  <span class='comment'># @option options [Boolean] :spy Enable this only if you want to enable debugging for the webserver
</span>  <span class='comment'># @option options [Integer]:backlog How many connections the server accepts
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_parse_options'>parse_options</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Options is not a hash </span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
    <span class='ivar'>@options</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_stringify_keys'>stringify_keys</span>
    <span class='ivar'>@backlog</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:backlog</span><span class='comma'>,</span> <span class='int'>1024</span><span class='rparen'>)</span>
    <span class='ivar'>@hostname</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:hostname</span><span class='comma'>,</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>WebServer</span><span class='op'>::</span><span class='const'>HOST</span><span class='rparen'>)</span>
    <span class='ivar'>@port</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:port</span><span class='comma'>,</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>WebServer</span><span class='op'>::</span><span class='const'>PORT</span><span class='rparen'>)</span>
    <span class='ivar'>@path</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:path</span><span class='comma'>,</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>WebServer</span><span class='op'>::</span><span class='const'>PATH</span><span class='rparen'>)</span>
    <span class='ivar'>@spy</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:spy</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'>#  checks if debug is enabled
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [boolean]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
  <span class='kw'>end</span>

  <span class='comment'>#  checks if debug is enabled
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [boolean]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DEBUG_CELLULOID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DEBUG_CELLULOID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>true</span><span class='tstring_end'>&#39;</span></span> <span class='op'>||</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DEBUG_CELLULOID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'>#  checks if debug is enabled
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [String] current_topic The Channel to which the reactor instance {CelluloidPubsub::Rector} will publish the message to
</span>  <span class='comment'># @param [Object] message
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_publish_event'>publish_event</span><span class='lparen'>(</span><span class='id identifier rubyid_current_topic'>current_topic</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_current_topic'>current_topic</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>||</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='ivar'>@subscribers</span><span class='lbracket'>[</span><span class='id identifier rubyid_current_topic'>current_topic</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_hash'>hash</span><span class='op'>|</span>
      <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='symbol'>:reactor</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_message'>message</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>#  callback that will execute when receiving new conections
</span>  <span class='comment'># If the connections is a websocket will call method {#route_websocket}
</span>  <span class='comment'># and if the connection is HTTP will call method {#route_request}
</span>  <span class='comment'># For websocket connections , the connection is detached from the server and dispatched to another actor
</span>  <span class='comment'>#
</span>  <span class='comment'># @see #route_websocket
</span>  <span class='comment'># @see #route_request
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Reel::WebSocket] connection The connection that was made to the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_on_connection'>on_connection</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='rparen'>)</span>
    <span class='kw'>while</span> <span class='id identifier rubyid_request'>request</span> <span class='op'>=</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_request'>request</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_websocket?'>websocket?</span>
        <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Received a WebSocket connection</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>

        <span class='comment'># We&#39;re going to hand off this connection to another actor (Writer/Reader)
</span>        <span class='comment'># However, initially Reel::Connections are &quot;attached&quot; to the
</span>        <span class='comment'># Reel::Server::HTTP actor, meaning that the server manages the connection
</span>        <span class='comment'># lifecycle (e.g. error handling) for us.
</span>        <span class='comment'>#
</span>        <span class='comment'># If we want to hand this connection off to another actor, we first
</span>        <span class='comment'># need to detach it from the Reel::Server (in this case, Reel::Server::HTTP)
</span>        <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_detach'>detach</span>
        <span class='id identifier rubyid_route_websocket'>route_websocket</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span><span class='rparen'>)</span>
        <span class='kw'>return</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_route_request'>route_request</span> <span class='id identifier rubyid_connection'>connection</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>#  HTTP connections are not accepted so this method will show 404 message &quot;Not Found&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Reel::WebSocket] connection The HTTP connection that was received
</span>  <span class='comment'># @param [Reel::Request] request The request that was made to the webserver and contains the type , the url, and the parameters
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_route_request'>route_request</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>404 Not Found: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_respond'>respond</span> <span class='symbol'>:not_found</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Not found</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='comment'>#  If the socket url matches with the one accepted by the server, it will dispatch the socket connection to a new reactor {CelluloidPubsub::Reactor#work}
</span>  <span class='comment'># The new actor is linked to the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @see CelluloidPubsub::Reactor#work
</span>  <span class='comment'>#
</span>  <span class='comment'>#  @param [Reel::WebSocket] socket The  web socket connection that was received
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_route_websocket'>route_websocket</span><span class='lparen'>(</span><span class='id identifier rubyid_socket'>socket</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span> <span class='op'>==</span> <span class='ivar'>@path</span>
      <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Reactor handles new socket connection</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
      <span class='id identifier rubyid_reactor'>reactor</span> <span class='op'>=</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>Reactor</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
      <span class='const'>Actor</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_link'>link</span> <span class='id identifier rubyid_reactor'>reactor</span>
      <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_async'>async</span><span class='period'>.</span><span class='id identifier rubyid_work'>work</span><span class='lparen'>(</span><span class='id identifier rubyid_socket'>socket</span><span class='comma'>,</span> <span class='const'>Actor</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Received invalid WebSocket request for: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
      <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># If the message can be parsed into a Hash it will respond to the reactor&#39;s websocket connection with the same message in JSON format
</span>  <span class='comment'># otherwise will try send the message how it is and escaped into JSON format
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [CelluloidPubsub::Reactor] reactor The  reactor that received an unhandled message
</span>  <span class='comment'># @param [Object] data The message that the reactor could not handle
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_handle_dispatched_message'>handle_dispatched_message</span><span class='lparen'>(</span><span class='id identifier rubyid_reactor'>reactor</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Webserver trying to dispatch message  </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_parse_json_data'>parse_json_data</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="port=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="port-instance_method">
  
    - (<tt>String</tt>) <strong>port</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns The port on which the webserver runs on</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The port on which the webserver runs on</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/celluloid_pubsub/web_server.rb', line 31</span>

<span class='kw'>class</span> <span class='const'>WebServer</span> <span class='op'>&lt;</span> <span class='const'>Reel</span><span class='op'>::</span><span class='const'>Server</span><span class='op'>::</span><span class='const'>HTTP</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Celluloid</span><span class='op'>::</span><span class='const'>Logger</span>

  <span class='comment'># The hostname on which the webserver runs on by default
</span>  <span class='const'>HOST</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0.0.0.0</span><span class='tstring_end'>&#39;</span></span>
  <span class='comment'># The port on which the webserver runs on by default
</span>  <span class='const'>PORT</span> <span class='op'>=</span> <span class='int'>1234</span>
  <span class='comment'># The request path that the webserver accepts by default
</span>  <span class='const'>PATH</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/ws</span><span class='tstring_end'>&#39;</span></span>

  <span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbol'>:options</span><span class='comma'>,</span> <span class='symbol'>:subscribers</span><span class='comma'>,</span> <span class='symbol'>:backlog</span><span class='comma'>,</span> <span class='symbol'>:hostname</span><span class='comma'>,</span> <span class='symbol'>:port</span><span class='comma'>,</span> <span class='symbol'>:path</span><span class='comma'>,</span> <span class='symbol'>:spy</span>

  <span class='comment'>#  receives a list of options that are used to configure the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @param  [Hash]  options the options that can be used to connect to webser and send additional data
</span>  <span class='comment'># @option options [String]:hostname The hostname on which the webserver runs on
</span>  <span class='comment'># @option options [Integer] :port The port on which the webserver runs on
</span>  <span class='comment'># @option options [String] :path The request path that the webserver accepts
</span>  <span class='comment'># @option options [Boolean] :spy Enable this only if you want to enable debugging for the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_parse_options'>parse_options</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='ivar'>@subscribers</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CelluloidPubsub::WebServer example starting on </span><span class='embexpr_beg'>#{</span><span class='ivar'>@hostname</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='ivar'>@port</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='kw'>super</span><span class='lparen'>(</span><span class='ivar'>@hostname</span><span class='comma'>,</span> <span class='ivar'>@port</span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='label'>spy:</span> <span class='ivar'>@spy</span><span class='comma'>,</span> <span class='label'>backlog:</span> <span class='ivar'>@backlog</span> <span class='rbrace'>}</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_method'>method</span><span class='lparen'>(</span><span class='symbol'>:on_connection</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'>#  receives a list of options that are used to configure the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @param  [Hash]  options the options that can be used to connect to webser and send additional data
</span>  <span class='comment'># @option options [String]:hostname The hostname on which the webserver runs on
</span>  <span class='comment'># @option options [Integer] :port The port on which the webserver runs on
</span>  <span class='comment'># @option options [String] :path The request path that the webserver accepts
</span>  <span class='comment'># @option options [Boolean] :spy Enable this only if you want to enable debugging for the webserver
</span>  <span class='comment'># @option options [Integer]:backlog How many connections the server accepts
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_parse_options'>parse_options</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Options is not a hash </span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
    <span class='ivar'>@options</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_stringify_keys'>stringify_keys</span>
    <span class='ivar'>@backlog</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:backlog</span><span class='comma'>,</span> <span class='int'>1024</span><span class='rparen'>)</span>
    <span class='ivar'>@hostname</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:hostname</span><span class='comma'>,</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>WebServer</span><span class='op'>::</span><span class='const'>HOST</span><span class='rparen'>)</span>
    <span class='ivar'>@port</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:port</span><span class='comma'>,</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>WebServer</span><span class='op'>::</span><span class='const'>PORT</span><span class='rparen'>)</span>
    <span class='ivar'>@path</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:path</span><span class='comma'>,</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>WebServer</span><span class='op'>::</span><span class='const'>PATH</span><span class='rparen'>)</span>
    <span class='ivar'>@spy</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:spy</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'>#  checks if debug is enabled
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [boolean]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
  <span class='kw'>end</span>

  <span class='comment'>#  checks if debug is enabled
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [boolean]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DEBUG_CELLULOID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DEBUG_CELLULOID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>true</span><span class='tstring_end'>&#39;</span></span> <span class='op'>||</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DEBUG_CELLULOID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'>#  checks if debug is enabled
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [String] current_topic The Channel to which the reactor instance {CelluloidPubsub::Rector} will publish the message to
</span>  <span class='comment'># @param [Object] message
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_publish_event'>publish_event</span><span class='lparen'>(</span><span class='id identifier rubyid_current_topic'>current_topic</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_current_topic'>current_topic</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>||</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='ivar'>@subscribers</span><span class='lbracket'>[</span><span class='id identifier rubyid_current_topic'>current_topic</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_hash'>hash</span><span class='op'>|</span>
      <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='symbol'>:reactor</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_message'>message</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>#  callback that will execute when receiving new conections
</span>  <span class='comment'># If the connections is a websocket will call method {#route_websocket}
</span>  <span class='comment'># and if the connection is HTTP will call method {#route_request}
</span>  <span class='comment'># For websocket connections , the connection is detached from the server and dispatched to another actor
</span>  <span class='comment'>#
</span>  <span class='comment'># @see #route_websocket
</span>  <span class='comment'># @see #route_request
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Reel::WebSocket] connection The connection that was made to the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_on_connection'>on_connection</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='rparen'>)</span>
    <span class='kw'>while</span> <span class='id identifier rubyid_request'>request</span> <span class='op'>=</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_request'>request</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_websocket?'>websocket?</span>
        <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Received a WebSocket connection</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>

        <span class='comment'># We&#39;re going to hand off this connection to another actor (Writer/Reader)
</span>        <span class='comment'># However, initially Reel::Connections are &quot;attached&quot; to the
</span>        <span class='comment'># Reel::Server::HTTP actor, meaning that the server manages the connection
</span>        <span class='comment'># lifecycle (e.g. error handling) for us.
</span>        <span class='comment'>#
</span>        <span class='comment'># If we want to hand this connection off to another actor, we first
</span>        <span class='comment'># need to detach it from the Reel::Server (in this case, Reel::Server::HTTP)
</span>        <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_detach'>detach</span>
        <span class='id identifier rubyid_route_websocket'>route_websocket</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span><span class='rparen'>)</span>
        <span class='kw'>return</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_route_request'>route_request</span> <span class='id identifier rubyid_connection'>connection</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>#  HTTP connections are not accepted so this method will show 404 message &quot;Not Found&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Reel::WebSocket] connection The HTTP connection that was received
</span>  <span class='comment'># @param [Reel::Request] request The request that was made to the webserver and contains the type , the url, and the parameters
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_route_request'>route_request</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>404 Not Found: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_respond'>respond</span> <span class='symbol'>:not_found</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Not found</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='comment'>#  If the socket url matches with the one accepted by the server, it will dispatch the socket connection to a new reactor {CelluloidPubsub::Reactor#work}
</span>  <span class='comment'># The new actor is linked to the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @see CelluloidPubsub::Reactor#work
</span>  <span class='comment'>#
</span>  <span class='comment'>#  @param [Reel::WebSocket] socket The  web socket connection that was received
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_route_websocket'>route_websocket</span><span class='lparen'>(</span><span class='id identifier rubyid_socket'>socket</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span> <span class='op'>==</span> <span class='ivar'>@path</span>
      <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Reactor handles new socket connection</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
      <span class='id identifier rubyid_reactor'>reactor</span> <span class='op'>=</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>Reactor</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
      <span class='const'>Actor</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_link'>link</span> <span class='id identifier rubyid_reactor'>reactor</span>
      <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_async'>async</span><span class='period'>.</span><span class='id identifier rubyid_work'>work</span><span class='lparen'>(</span><span class='id identifier rubyid_socket'>socket</span><span class='comma'>,</span> <span class='const'>Actor</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Received invalid WebSocket request for: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
      <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># If the message can be parsed into a Hash it will respond to the reactor&#39;s websocket connection with the same message in JSON format
</span>  <span class='comment'># otherwise will try send the message how it is and escaped into JSON format
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [CelluloidPubsub::Reactor] reactor The  reactor that received an unhandled message
</span>  <span class='comment'># @param [Object] data The message that the reactor could not handle
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_handle_dispatched_message'>handle_dispatched_message</span><span class='lparen'>(</span><span class='id identifier rubyid_reactor'>reactor</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Webserver trying to dispatch message  </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_parse_json_data'>parse_json_data</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="spy=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="spy-instance_method">
  
    - (<tt>Boolean</tt>) <strong>spy</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns Enable this only if you want to enable debugging for the webserver</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Enable this only if you want to enable debugging for the webserver</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/celluloid_pubsub/web_server.rb', line 31</span>

<span class='kw'>class</span> <span class='const'>WebServer</span> <span class='op'>&lt;</span> <span class='const'>Reel</span><span class='op'>::</span><span class='const'>Server</span><span class='op'>::</span><span class='const'>HTTP</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Celluloid</span><span class='op'>::</span><span class='const'>Logger</span>

  <span class='comment'># The hostname on which the webserver runs on by default
</span>  <span class='const'>HOST</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0.0.0.0</span><span class='tstring_end'>&#39;</span></span>
  <span class='comment'># The port on which the webserver runs on by default
</span>  <span class='const'>PORT</span> <span class='op'>=</span> <span class='int'>1234</span>
  <span class='comment'># The request path that the webserver accepts by default
</span>  <span class='const'>PATH</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/ws</span><span class='tstring_end'>&#39;</span></span>

  <span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbol'>:options</span><span class='comma'>,</span> <span class='symbol'>:subscribers</span><span class='comma'>,</span> <span class='symbol'>:backlog</span><span class='comma'>,</span> <span class='symbol'>:hostname</span><span class='comma'>,</span> <span class='symbol'>:port</span><span class='comma'>,</span> <span class='symbol'>:path</span><span class='comma'>,</span> <span class='symbol'>:spy</span>

  <span class='comment'>#  receives a list of options that are used to configure the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @param  [Hash]  options the options that can be used to connect to webser and send additional data
</span>  <span class='comment'># @option options [String]:hostname The hostname on which the webserver runs on
</span>  <span class='comment'># @option options [Integer] :port The port on which the webserver runs on
</span>  <span class='comment'># @option options [String] :path The request path that the webserver accepts
</span>  <span class='comment'># @option options [Boolean] :spy Enable this only if you want to enable debugging for the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_parse_options'>parse_options</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='ivar'>@subscribers</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CelluloidPubsub::WebServer example starting on </span><span class='embexpr_beg'>#{</span><span class='ivar'>@hostname</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='ivar'>@port</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='kw'>super</span><span class='lparen'>(</span><span class='ivar'>@hostname</span><span class='comma'>,</span> <span class='ivar'>@port</span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='label'>spy:</span> <span class='ivar'>@spy</span><span class='comma'>,</span> <span class='label'>backlog:</span> <span class='ivar'>@backlog</span> <span class='rbrace'>}</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_method'>method</span><span class='lparen'>(</span><span class='symbol'>:on_connection</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'>#  receives a list of options that are used to configure the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @param  [Hash]  options the options that can be used to connect to webser and send additional data
</span>  <span class='comment'># @option options [String]:hostname The hostname on which the webserver runs on
</span>  <span class='comment'># @option options [Integer] :port The port on which the webserver runs on
</span>  <span class='comment'># @option options [String] :path The request path that the webserver accepts
</span>  <span class='comment'># @option options [Boolean] :spy Enable this only if you want to enable debugging for the webserver
</span>  <span class='comment'># @option options [Integer]:backlog How many connections the server accepts
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_parse_options'>parse_options</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Options is not a hash </span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
    <span class='ivar'>@options</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_stringify_keys'>stringify_keys</span>
    <span class='ivar'>@backlog</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:backlog</span><span class='comma'>,</span> <span class='int'>1024</span><span class='rparen'>)</span>
    <span class='ivar'>@hostname</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:hostname</span><span class='comma'>,</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>WebServer</span><span class='op'>::</span><span class='const'>HOST</span><span class='rparen'>)</span>
    <span class='ivar'>@port</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:port</span><span class='comma'>,</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>WebServer</span><span class='op'>::</span><span class='const'>PORT</span><span class='rparen'>)</span>
    <span class='ivar'>@path</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:path</span><span class='comma'>,</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>WebServer</span><span class='op'>::</span><span class='const'>PATH</span><span class='rparen'>)</span>
    <span class='ivar'>@spy</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:spy</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'>#  checks if debug is enabled
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [boolean]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
  <span class='kw'>end</span>

  <span class='comment'>#  checks if debug is enabled
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [boolean]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DEBUG_CELLULOID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DEBUG_CELLULOID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>true</span><span class='tstring_end'>&#39;</span></span> <span class='op'>||</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DEBUG_CELLULOID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'>#  checks if debug is enabled
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [String] current_topic The Channel to which the reactor instance {CelluloidPubsub::Rector} will publish the message to
</span>  <span class='comment'># @param [Object] message
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_publish_event'>publish_event</span><span class='lparen'>(</span><span class='id identifier rubyid_current_topic'>current_topic</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_current_topic'>current_topic</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>||</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='ivar'>@subscribers</span><span class='lbracket'>[</span><span class='id identifier rubyid_current_topic'>current_topic</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_hash'>hash</span><span class='op'>|</span>
      <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='symbol'>:reactor</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_message'>message</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>#  callback that will execute when receiving new conections
</span>  <span class='comment'># If the connections is a websocket will call method {#route_websocket}
</span>  <span class='comment'># and if the connection is HTTP will call method {#route_request}
</span>  <span class='comment'># For websocket connections , the connection is detached from the server and dispatched to another actor
</span>  <span class='comment'>#
</span>  <span class='comment'># @see #route_websocket
</span>  <span class='comment'># @see #route_request
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Reel::WebSocket] connection The connection that was made to the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_on_connection'>on_connection</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='rparen'>)</span>
    <span class='kw'>while</span> <span class='id identifier rubyid_request'>request</span> <span class='op'>=</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_request'>request</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_websocket?'>websocket?</span>
        <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Received a WebSocket connection</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>

        <span class='comment'># We&#39;re going to hand off this connection to another actor (Writer/Reader)
</span>        <span class='comment'># However, initially Reel::Connections are &quot;attached&quot; to the
</span>        <span class='comment'># Reel::Server::HTTP actor, meaning that the server manages the connection
</span>        <span class='comment'># lifecycle (e.g. error handling) for us.
</span>        <span class='comment'>#
</span>        <span class='comment'># If we want to hand this connection off to another actor, we first
</span>        <span class='comment'># need to detach it from the Reel::Server (in this case, Reel::Server::HTTP)
</span>        <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_detach'>detach</span>
        <span class='id identifier rubyid_route_websocket'>route_websocket</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span><span class='rparen'>)</span>
        <span class='kw'>return</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_route_request'>route_request</span> <span class='id identifier rubyid_connection'>connection</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>#  HTTP connections are not accepted so this method will show 404 message &quot;Not Found&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Reel::WebSocket] connection The HTTP connection that was received
</span>  <span class='comment'># @param [Reel::Request] request The request that was made to the webserver and contains the type , the url, and the parameters
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_route_request'>route_request</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>404 Not Found: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_respond'>respond</span> <span class='symbol'>:not_found</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Not found</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='comment'>#  If the socket url matches with the one accepted by the server, it will dispatch the socket connection to a new reactor {CelluloidPubsub::Reactor#work}
</span>  <span class='comment'># The new actor is linked to the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @see CelluloidPubsub::Reactor#work
</span>  <span class='comment'>#
</span>  <span class='comment'>#  @param [Reel::WebSocket] socket The  web socket connection that was received
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_route_websocket'>route_websocket</span><span class='lparen'>(</span><span class='id identifier rubyid_socket'>socket</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span> <span class='op'>==</span> <span class='ivar'>@path</span>
      <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Reactor handles new socket connection</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
      <span class='id identifier rubyid_reactor'>reactor</span> <span class='op'>=</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>Reactor</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
      <span class='const'>Actor</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_link'>link</span> <span class='id identifier rubyid_reactor'>reactor</span>
      <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_async'>async</span><span class='period'>.</span><span class='id identifier rubyid_work'>work</span><span class='lparen'>(</span><span class='id identifier rubyid_socket'>socket</span><span class='comma'>,</span> <span class='const'>Actor</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Received invalid WebSocket request for: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
      <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># If the message can be parsed into a Hash it will respond to the reactor&#39;s websocket connection with the same message in JSON format
</span>  <span class='comment'># otherwise will try send the message how it is and escaped into JSON format
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [CelluloidPubsub::Reactor] reactor The  reactor that received an unhandled message
</span>  <span class='comment'># @param [Object] data The message that the reactor could not handle
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_handle_dispatched_message'>handle_dispatched_message</span><span class='lparen'>(</span><span class='id identifier rubyid_reactor'>reactor</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Webserver trying to dispatch message  </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_parse_json_data'>parse_json_data</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="subscribers=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="subscribers-instance_method">
  
    - (<tt>Hash</tt>) <strong>subscribers</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns The hostname on which the webserver runs on</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The hostname on which the webserver runs on</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/celluloid_pubsub/web_server.rb', line 31</span>

<span class='kw'>class</span> <span class='const'>WebServer</span> <span class='op'>&lt;</span> <span class='const'>Reel</span><span class='op'>::</span><span class='const'>Server</span><span class='op'>::</span><span class='const'>HTTP</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Celluloid</span><span class='op'>::</span><span class='const'>Logger</span>

  <span class='comment'># The hostname on which the webserver runs on by default
</span>  <span class='const'>HOST</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0.0.0.0</span><span class='tstring_end'>&#39;</span></span>
  <span class='comment'># The port on which the webserver runs on by default
</span>  <span class='const'>PORT</span> <span class='op'>=</span> <span class='int'>1234</span>
  <span class='comment'># The request path that the webserver accepts by default
</span>  <span class='const'>PATH</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/ws</span><span class='tstring_end'>&#39;</span></span>

  <span class='id identifier rubyid_attr_accessor'>attr_accessor</span> <span class='symbol'>:options</span><span class='comma'>,</span> <span class='symbol'>:subscribers</span><span class='comma'>,</span> <span class='symbol'>:backlog</span><span class='comma'>,</span> <span class='symbol'>:hostname</span><span class='comma'>,</span> <span class='symbol'>:port</span><span class='comma'>,</span> <span class='symbol'>:path</span><span class='comma'>,</span> <span class='symbol'>:spy</span>

  <span class='comment'>#  receives a list of options that are used to configure the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @param  [Hash]  options the options that can be used to connect to webser and send additional data
</span>  <span class='comment'># @option options [String]:hostname The hostname on which the webserver runs on
</span>  <span class='comment'># @option options [Integer] :port The port on which the webserver runs on
</span>  <span class='comment'># @option options [String] :path The request path that the webserver accepts
</span>  <span class='comment'># @option options [Boolean] :spy Enable this only if you want to enable debugging for the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_parse_options'>parse_options</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='ivar'>@subscribers</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CelluloidPubsub::WebServer example starting on </span><span class='embexpr_beg'>#{</span><span class='ivar'>@hostname</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='ivar'>@port</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='kw'>super</span><span class='lparen'>(</span><span class='ivar'>@hostname</span><span class='comma'>,</span> <span class='ivar'>@port</span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='label'>spy:</span> <span class='ivar'>@spy</span><span class='comma'>,</span> <span class='label'>backlog:</span> <span class='ivar'>@backlog</span> <span class='rbrace'>}</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_method'>method</span><span class='lparen'>(</span><span class='symbol'>:on_connection</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'>#  receives a list of options that are used to configure the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @param  [Hash]  options the options that can be used to connect to webser and send additional data
</span>  <span class='comment'># @option options [String]:hostname The hostname on which the webserver runs on
</span>  <span class='comment'># @option options [Integer] :port The port on which the webserver runs on
</span>  <span class='comment'># @option options [String] :path The request path that the webserver accepts
</span>  <span class='comment'># @option options [Boolean] :spy Enable this only if you want to enable debugging for the webserver
</span>  <span class='comment'># @option options [Integer]:backlog How many connections the server accepts
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_parse_options'>parse_options</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Options is not a hash </span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
    <span class='ivar'>@options</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_stringify_keys'>stringify_keys</span>
    <span class='ivar'>@backlog</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:backlog</span><span class='comma'>,</span> <span class='int'>1024</span><span class='rparen'>)</span>
    <span class='ivar'>@hostname</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:hostname</span><span class='comma'>,</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>WebServer</span><span class='op'>::</span><span class='const'>HOST</span><span class='rparen'>)</span>
    <span class='ivar'>@port</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:port</span><span class='comma'>,</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>WebServer</span><span class='op'>::</span><span class='const'>PORT</span><span class='rparen'>)</span>
    <span class='ivar'>@path</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:path</span><span class='comma'>,</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>WebServer</span><span class='op'>::</span><span class='const'>PATH</span><span class='rparen'>)</span>
    <span class='ivar'>@spy</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:spy</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'>#  checks if debug is enabled
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [boolean]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
  <span class='kw'>end</span>

  <span class='comment'>#  checks if debug is enabled
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [boolean]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DEBUG_CELLULOID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DEBUG_CELLULOID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>true</span><span class='tstring_end'>&#39;</span></span> <span class='op'>||</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DEBUG_CELLULOID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'>#  checks if debug is enabled
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [String] current_topic The Channel to which the reactor instance {CelluloidPubsub::Rector} will publish the message to
</span>  <span class='comment'># @param [Object] message
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_publish_event'>publish_event</span><span class='lparen'>(</span><span class='id identifier rubyid_current_topic'>current_topic</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_current_topic'>current_topic</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>||</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='ivar'>@subscribers</span><span class='lbracket'>[</span><span class='id identifier rubyid_current_topic'>current_topic</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_hash'>hash</span><span class='op'>|</span>
      <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='symbol'>:reactor</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_message'>message</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>#  callback that will execute when receiving new conections
</span>  <span class='comment'># If the connections is a websocket will call method {#route_websocket}
</span>  <span class='comment'># and if the connection is HTTP will call method {#route_request}
</span>  <span class='comment'># For websocket connections , the connection is detached from the server and dispatched to another actor
</span>  <span class='comment'>#
</span>  <span class='comment'># @see #route_websocket
</span>  <span class='comment'># @see #route_request
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Reel::WebSocket] connection The connection that was made to the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_on_connection'>on_connection</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='rparen'>)</span>
    <span class='kw'>while</span> <span class='id identifier rubyid_request'>request</span> <span class='op'>=</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_request'>request</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_websocket?'>websocket?</span>
        <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Received a WebSocket connection</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>

        <span class='comment'># We&#39;re going to hand off this connection to another actor (Writer/Reader)
</span>        <span class='comment'># However, initially Reel::Connections are &quot;attached&quot; to the
</span>        <span class='comment'># Reel::Server::HTTP actor, meaning that the server manages the connection
</span>        <span class='comment'># lifecycle (e.g. error handling) for us.
</span>        <span class='comment'>#
</span>        <span class='comment'># If we want to hand this connection off to another actor, we first
</span>        <span class='comment'># need to detach it from the Reel::Server (in this case, Reel::Server::HTTP)
</span>        <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_detach'>detach</span>
        <span class='id identifier rubyid_route_websocket'>route_websocket</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span><span class='rparen'>)</span>
        <span class='kw'>return</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_route_request'>route_request</span> <span class='id identifier rubyid_connection'>connection</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'>#  HTTP connections are not accepted so this method will show 404 message &quot;Not Found&quot;
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [Reel::WebSocket] connection The HTTP connection that was received
</span>  <span class='comment'># @param [Reel::Request] request The request that was made to the webserver and contains the type , the url, and the parameters
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_route_request'>route_request</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>404 Not Found: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_respond'>respond</span> <span class='symbol'>:not_found</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Not found</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='comment'>#  If the socket url matches with the one accepted by the server, it will dispatch the socket connection to a new reactor {CelluloidPubsub::Reactor#work}
</span>  <span class='comment'># The new actor is linked to the webserver
</span>  <span class='comment'>#
</span>  <span class='comment'># @see CelluloidPubsub::Reactor#work
</span>  <span class='comment'>#
</span>  <span class='comment'>#  @param [Reel::WebSocket] socket The  web socket connection that was received
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_route_websocket'>route_websocket</span><span class='lparen'>(</span><span class='id identifier rubyid_socket'>socket</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span> <span class='op'>==</span> <span class='ivar'>@path</span>
      <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Reactor handles new socket connection</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
      <span class='id identifier rubyid_reactor'>reactor</span> <span class='op'>=</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>Reactor</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
      <span class='const'>Actor</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_link'>link</span> <span class='id identifier rubyid_reactor'>reactor</span>
      <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_async'>async</span><span class='period'>.</span><span class='id identifier rubyid_work'>work</span><span class='lparen'>(</span><span class='id identifier rubyid_socket'>socket</span><span class='comma'>,</span> <span class='const'>Actor</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Received invalid WebSocket request for: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
      <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># If the message can be parsed into a Hash it will respond to the reactor&#39;s websocket connection with the same message in JSON format
</span>  <span class='comment'># otherwise will try send the message how it is and escaped into JSON format
</span>  <span class='comment'>#
</span>  <span class='comment'># @param [CelluloidPubsub::Reactor] reactor The  reactor that received an unhandled message
</span>  <span class='comment'># @param [Object] data The message that the reactor could not handle
</span>  <span class='comment'>#
</span>  <span class='comment'># @return [void]
</span>  <span class='comment'>#
</span>  <span class='comment'># @api public
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_handle_dispatched_message'>handle_dispatched_message</span><span class='lparen'>(</span><span class='id identifier rubyid_reactor'>reactor</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Webserver trying to dispatch message  </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_parse_json_data'>parse_json_data</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="debug_enabled?-class_method">
  
    + (<tt>boolean</tt>) <strong>debug_enabled?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>checks if debug is enabled</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


97
98
99</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/celluloid_pubsub/web_server.rb', line 97</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
  <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DEBUG_CELLULOID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DEBUG_CELLULOID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>true</span><span class='tstring_end'>&#39;</span></span> <span class='op'>||</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DEBUG_CELLULOID</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='kw'>true</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="debug_enabled?-instance_method">
  
    - (<tt>boolean</tt>) <strong>debug_enabled?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>checks if debug is enabled</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


88
89
90</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/celluloid_pubsub/web_server.rb', line 88</span>

<span class='kw'>def</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='period'>.</span><span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="handle_dispatched_message-instance_method">
  
    - (<tt>void</tt>) <strong>handle_dispatched_message</strong>(reactor, data) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>If the message can be parsed into a Hash it will respond to the
reactor&#39;s websocket connection with the same message in JSON format
otherwise will try send the message how it is and escaped into JSON format</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>reactor</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Reactor.html" title="CelluloidPubsub::Reactor (class)">CelluloidPubsub::Reactor</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The  reactor that received an unhandled message</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>data</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The message that the reactor could not handle</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


194
195
196
197
198
199
200
201
202</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/celluloid_pubsub/web_server.rb', line 194</span>

<span class='kw'>def</span> <span class='id identifier rubyid_handle_dispatched_message'>handle_dispatched_message</span><span class='lparen'>(</span><span class='id identifier rubyid_reactor'>reactor</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Webserver trying to dispatch message  </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
  <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_parse_json_data'>parse_json_data</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_connection-instance_method">
  
    - (<tt>void</tt>) <strong>on_connection</strong>(connection) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>callback that will execute when receiving new conections If the connections
is a websocket will call method <span class='object_link'><a href="#route_websocket-instance_method" title="CelluloidPubsub::WebServer#route_websocket (method)">#route_websocket</a></span> and if the connection is
HTTP will call method <span class='object_link'><a href="#route_request-instance_method" title="CelluloidPubsub::WebServer#route_request (method)">#route_request</a></span> For websocket connections , the
connection is detached from the server and dispatched to another actor</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>connection</span>
      
      
        <span class='type'>(<tt>Reel::WebSocket</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The connection that was made to the webserver</p>
</div>
      
    </li>
  
</ul>


  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#route_websocket-instance_method" title="CelluloidPubsub::WebServer#route_websocket (method)">#route_websocket</a></span></li>
    
      <li><span class='object_link'><a href="#route_request-instance_method" title="CelluloidPubsub::WebServer#route_request (method)">#route_request</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/celluloid_pubsub/web_server.rb', line 129</span>

<span class='kw'>def</span> <span class='id identifier rubyid_on_connection'>on_connection</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='rparen'>)</span>
  <span class='kw'>while</span> <span class='id identifier rubyid_request'>request</span> <span class='op'>=</span> <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_request'>request</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_websocket?'>websocket?</span>
      <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Received a WebSocket connection</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>

      <span class='comment'># We&#39;re going to hand off this connection to another actor (Writer/Reader)
</span>      <span class='comment'># However, initially Reel::Connections are &quot;attached&quot; to the
</span>      <span class='comment'># Reel::Server::HTTP actor, meaning that the server manages the connection
</span>      <span class='comment'># lifecycle (e.g. error handling) for us.
</span>      <span class='comment'>#
</span>      <span class='comment'># If we want to hand this connection off to another actor, we first
</span>      <span class='comment'># need to detach it from the Reel::Server (in this case, Reel::Server::HTTP)
</span>      <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_detach'>detach</span>
      <span class='id identifier rubyid_route_websocket'>route_websocket</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span><span class='rparen'>)</span>
      <span class='kw'>return</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_route_request'>route_request</span> <span class='id identifier rubyid_connection'>connection</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="parse_options-instance_method">
  
    - (<tt>void</tt>) <strong>parse_options</strong>(options) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>receives a list of options that are used to configure the webserver</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the options that can be used to connect to webser and send additional data</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:hostname</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The hostname on which the webserver runs on</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:port</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The port on which the webserver runs on</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:path</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>The request path that the webserver accepts</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:spy</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>Enable this only if you want to enable debugging for the webserver</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:backlog</span>
          <span class="type">(<tt>Integer</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'>
<p>How many connections the server accepts</p>
</div>
          
        </li>
      
    </ul>
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


73
74
75
76
77
78
79
80
81</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/celluloid_pubsub/web_server.rb', line 73</span>

<span class='kw'>def</span> <span class='id identifier rubyid_parse_options'>parse_options</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Options is not a hash </span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
  <span class='ivar'>@options</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_stringify_keys'>stringify_keys</span>
  <span class='ivar'>@backlog</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:backlog</span><span class='comma'>,</span> <span class='int'>1024</span><span class='rparen'>)</span>
  <span class='ivar'>@hostname</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:hostname</span><span class='comma'>,</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>WebServer</span><span class='op'>::</span><span class='const'>HOST</span><span class='rparen'>)</span>
  <span class='ivar'>@port</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:port</span><span class='comma'>,</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>WebServer</span><span class='op'>::</span><span class='const'>PORT</span><span class='rparen'>)</span>
  <span class='ivar'>@path</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:path</span><span class='comma'>,</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>WebServer</span><span class='op'>::</span><span class='const'>PATH</span><span class='rparen'>)</span>
  <span class='ivar'>@spy</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:spy</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="publish_event-instance_method">
  
    - (<tt>void</tt>) <strong>publish_event</strong>(current_topic, message) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>checks if debug is enabled</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>current_topic</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The Channel to which the reactor instance Rector will
publish the message to</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>message</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


109
110
111
112
113
114</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/celluloid_pubsub/web_server.rb', line 109</span>

<span class='kw'>def</span> <span class='id identifier rubyid_publish_event'>publish_event</span><span class='lparen'>(</span><span class='id identifier rubyid_current_topic'>current_topic</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_current_topic'>current_topic</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>||</span> <span class='id identifier rubyid_message'>message</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
  <span class='ivar'>@subscribers</span><span class='lbracket'>[</span><span class='id identifier rubyid_current_topic'>current_topic</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_hash'>hash</span><span class='op'>|</span>
    <span class='id identifier rubyid_hash'>hash</span><span class='lbracket'>[</span><span class='symbol'>:reactor</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_websocket'>websocket</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_message'>message</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="route_request-instance_method">
  
    - (<tt>void</tt>) <strong>route_request</strong>(connection, request) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>HTTP connections are not accepted so this method will show 404 message “Not
Found”</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>connection</span>
      
      
        <span class='type'>(<tt>Reel::WebSocket</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The HTTP connection that was received</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>request</span>
      
      
        <span class='type'>(<tt>Reel::Request</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The request that was made to the webserver and contains the type , the url,
and the parameters</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


158
159
160
161</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/celluloid_pubsub/web_server.rb', line 158</span>

<span class='kw'>def</span> <span class='id identifier rubyid_route_request'>route_request</span><span class='lparen'>(</span><span class='id identifier rubyid_connection'>connection</span><span class='comma'>,</span> <span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>404 Not Found: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
  <span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_respond'>respond</span> <span class='symbol'>:not_found</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Not found</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="route_websocket-instance_method">
  
    - (<tt>void</tt>) <strong>route_websocket</strong>(socket) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>If the socket url matches with the one accepted by the server, it will
dispatch the socket connection to a new reactor
<span class='object_link'><a href="Reactor.html#work-instance_method" title="CelluloidPubsub::Reactor#work (method)">Reactor#work</a></span> The new actor is linked to the webserver</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="Reactor.html#work-instance_method" title="CelluloidPubsub::Reactor#work (method)">@param [Reel::WebSocket] socket The  web socket connection that was received</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


173
174
175
176
177
178
179
180
181
182
183</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/celluloid_pubsub/web_server.rb', line 173</span>

<span class='kw'>def</span> <span class='id identifier rubyid_route_websocket'>route_websocket</span><span class='lparen'>(</span><span class='id identifier rubyid_socket'>socket</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span> <span class='op'>==</span> <span class='ivar'>@path</span>
    <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Reactor handles new socket connection</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='id identifier rubyid_reactor'>reactor</span> <span class='op'>=</span> <span class='const'>CelluloidPubsub</span><span class='op'>::</span><span class='const'>Reactor</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='const'>Actor</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_link'>link</span> <span class='id identifier rubyid_reactor'>reactor</span>
    <span class='id identifier rubyid_reactor'>reactor</span><span class='period'>.</span><span class='id identifier rubyid_async'>async</span><span class='period'>.</span><span class='id identifier rubyid_work'>work</span><span class='lparen'>(</span><span class='id identifier rubyid_socket'>socket</span><span class='comma'>,</span> <span class='const'>Actor</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Received invalid WebSocket request for: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_debug_enabled?'>debug_enabled?</span>
    <span class='id identifier rubyid_socket'>socket</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Fri Mar 13 12:25:43 2015 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.0.0).
</div>

  </body>
</html>